<html>
<head>
<title>Task List built with React JS</title>
<script src="https://fb.me/react-0.13.3.js"></script>
<script src="https://fb.me/JSXTransformer-0.13.3.js"></script>
<script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/marked/0.3.2/marked.min.js"></script>
</head>
<body>
<div id="app"></div>
<script type="text/jsx">

  var TaskBox = React.createClass({
    loadTasksFromServer: function() {
      $.ajax({
        url: this.props.url,
        dataType: 'json',
        cache: false,
        success: function(data) {
          this.setState({data: data});
        }.bind(this),
        error: function(xhr, status, err) {
          console.error(this.props.url, status, err.toString());
        }.bind(this)
      });
    },
    handleTaskSubmit: function(task) {
      var tasks = this.state.data;
      var newTask = tasks.concat([task]);
      this.setState({data: newTask});
      $.ajax({
        url: this.props.url,
        dataType: 'json',
        type: 'POST',
        data: task,
        success: function(data) {
          this.setState({data: data});
        }.bind(this),
        error: function(xhr, status, err) {
          console.error(this.props.url, status, err.toString());
        }.bind(this)
      });
    },
    getInitialState: function() {
      return{data: []};
    },
    componentDidMount: function() {
      this.loadTasksFromServer();
      setInterval(this.loadTasksFromServer, this.props.pollInterval);
    },
    render: function() {
      return (
        <div className="taskBox">
          <h1 className="projectTitle">Website Pre-Launch Task List</h1>
          <TaskForm onTaskSubmit={this.handleTaskSubmit} />
          <TaskList data={this.state.data} />
        </div>
      );
    }
  });

  var TaskList = React.createClass({
    render: function() {
      var taskNodes = this.props.data.map(function (task) {
        return (
          <Task name={task.name} status={task.status}></Task>
        );
      });
      return (
        <div className="taskList">
          {taskNodes}
        </div>
      );
    }
  });

  var Task = React.createClass({
    getInitialState: function() {
      return {
        checked: this.props.status,
        taskStatusClass: "incomplete"
      }
    },
    // componentWillMount: function() {
    //   this.props.taskStatusClass = "incomplete";
    // },
    statusChange: function(event) {
      this.setState({checked: event.target.checked});//this sets the state of the element to match the state of the element using the onChange method  
      this.state.checked = event.target.checked;

      if(this.state.checked === true) {
        this.setState({taskStatusClass: "complete"});
      } else {
        this.setState({taskStatusClass: "incomplete"});
      }
      console.log(taskStatusClass);
    },
    render: function() {
      return (
        <div className="task">
          <h2 className={this.state.taskStatusClass} >{this.props.name}</h2>
          <form><input type="checkbox" name="status" onChange={this.statusChange} /></form>
        </div>
      );
    }
  });

  var TaskForm = React.createClass({
    handleSubmit: function(e) {
      e.preventDefault();
      var name = React.findDOMNode(this.refs.name).value.trim();
      var defaultStatus = false;
      if (!name) {
        return;
      }
      this.props.onTaskSubmit({name: name, status: defaultStatus});
      React.findDOMNode(this.refs.name).value = '';
    },
    render: function() {
      return(
        <form className="taskForm" onSubmit={this.handleSubmit}>
          <input type="text" placeholder="What is the task you would like to add?" ref="name"/>
          <input type="submit" value="Add Task" ref="defaultStatus" />
        </form>
      );
    }
  });

  React.render(
    <TaskBox url="tasks.json" pollInterval={2000} />,
    document.getElementById('app')
  );

// props is used to pass data from Parent to Child
// this.props is declared on the child, to access it's parents information
// props are "interchangable" with html tag properties

</script>
</body>
</html>